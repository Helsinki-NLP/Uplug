#!/bin/bash
#
# convert xml-files to CWB format
#
# Copyright (C) 2004 Jörg Tiedemann  <joerg@stp.ling.uu.se>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
#--------------------------------------------------------
# usage: make-cwb-corpus USER CORPUS LANG ENCODING
#
#     USER: user name (= sub-directory of DATAHOME)
#   CORPUS: name of the corpus (= sub-directory of DATAHOME/USER)
#     LANG: language (= name of the corpus)
# ENCODING: character encoding in the CWB index (default: latin1)
#
# the following files and locations are assumed to exist:
#
#          corpus: DATAHOME/USER/CORPUS/LANG.gz
#
#        DATAHOME: /corpora/OPUS/uplug2
#         CWBHOME: /corpora/OPUS/uplug2-cwb
#


USER=$1;
CORPUS=$2;
LA=$3;
ENC=$4;

DATAHOME='/corpora/OPUS/uplug2';
CWBHOME='/corpora/OPUS/uplug2-cwb';
CWBBIN='/usr/local/bin';
SCRIPT='/corpora/OPUS/uplug2-cwb';

DATA="$DATAHOME/$USER/$CORPUS";
REGDIR="$CWBHOME/reg/$USER";
DATDIR="$CWBHOME/dat/$USER";

MKDIR='mkdir -p';
CD='cd';
RM='rm';
RMDIR='rmdir';
CAT='cat';

DIR=$PWD;
TMP='/tmp/CWBCORPUSTEMP';
$MKDIR $TMP;
$CD $TMP

#-----------------------------------------------

ENCODE="$CWBBIN/cwb-encode";
CWBMAKEALL="${CWBBIN}/cwb-makeall";
XML2CWB="$SCRIPT/xml2cwb";

#-----------------------------------------------

$XML2CWB -c $ENC -a -p $LA.pos ${DATA}/$LA.gz 2>$LA.cmd > $LA;
ATTR=`$CAT $LA.cmd`;

$MKDIR "$DATDIR/$CORPUS/$LA";
$MKDIR "$REGDIR/$CORPUS";

$ENCODE -R $REGDIR/$CORPUS/$LA -d $DATDIR/$CORPUS/$LA -f $LA $ATTR
$CWBMAKEALL -r $REGDIR/$CORPUS -V $LA

#-----------------------------------------------

$RM $TMP/*
$RMDIR $TMP

$CD $DIR;

